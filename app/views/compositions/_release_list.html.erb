<% suppress_header = nil unless local_assigns.has_key? :suppress_header %>
<% use_paging = false unless local_assigns.has_key? :use_paging %>
<% show_search = false unless local_assigns.has_key? :show_search %>
<% page_length = 10 unless local_assigns.has_key? :page_length %>
<% table_id = "" unless local_assigns.has_key? :table_id %>
<% frame_name = "table_frame" unless local_assigns.has_key? :frame_name %>

<% unless use_paging %>
  <%= render 'shared/result_count', pagy: @pagy, resource_label: "release" %>
<% end %>

<table class="table table-striped table-hover main-search-list"
       data-id="<%= table_id %>"
       data-table-name="Releases"
       data-controller="<%= 'infinite-scroll' unless use_paging %>"
       data-infinite-scroll-url-value="/compositions/infinite_scroll"
       data-infinite-scroll-current-page-value="<%= defined?(@pagy) && @pagy ? @pagy.page : 1 %>"
       data-infinite-scroll-has-next-page-value="<%= defined?(@pagy) && @pagy ? @pagy.next.present? : false %>"
       data-infinite-scroll-current-sort-value="<%= params[:sort] %>"
       data-infinite-scroll-current-direction-value="<%= params[:direction] %>"
       data-infinite-scroll-search-type-value="<%= params[:search_type] %>"
       data-infinite-scroll-search-value-value="<%= params[:search_value] %>"
       data-infinite-scroll-query-type-value="<%= params[:query_id].present? ? 'quick_query' : 'search' %>"
       data-infinite-scroll-query-id-value="<%= params[:query_id] %>"
       data-infinite-scroll-query-attribute-value="<%= params[:query_attribute] %>"
       data-infinite-scroll-advanced-query-params-value="<%= {
          release_type: params[:release_type]
       }.compact.to_json %>"       
       >

  <% if not suppress_header %>
    <thead>
    <tr>
      <th style="width: 30%;"><%= sortable_column_header('title', 'Title', params[:sort], params[:direction], frame_name) %></th>
      <th style="width: 20%;"><%= sortable_column_header('artist', 'Artist', params[:sort], params[:direction], frame_name) %></th>
      <th style="width: 10%;"><%= sortable_column_header('type', 'Type', params[:sort], params[:direction], frame_name) %></th>
      <th style="width: 10%;"><%= sortable_column_header('year', 'Year', params[:sort], params[:direction], frame_name) %></th>
      <% if can? :manage, Composition %>
        <th style="width: 10%;">Actions</th>
      <% end %>
    </tr>
    </thead>
  <% end %>
  <tbody data-infinite-scroll-target="tbody">
  <%= render '/compositions/composition_rows', albums: albums %>
  </tbody>
</table>

<% if use_paging && defined?(@pagy) && @pagy && @pagy.pages > 1 %>
  <%= render 'shared/pagination', pagy: @pagy %>
<% end %>
